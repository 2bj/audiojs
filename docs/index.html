<!DOCTYPE html>  <html> <head>   <title>audio.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               audio.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>A cross-browser javascript shim for html5 audio</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">audiojs</span><span class="p">,</span> <span class="nx">audiojsInstance</span><span class="p">,</span> <span class="nx">container</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Use the path to the audio.js file to create relative paths to the swf and player graphics
Remember that some systems (e.g. ruby on rails) append strings like '?1301478336' to asset paths</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">re</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;audio(\.min)?\.js.*&#39;</span><span class="p">),</span>
        <span class="nx">scripts</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ii</span> <span class="o">=</span> <span class="nx">scripts</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">scripts</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">re</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">path</span><span class="p">))</span> <span class="k">return</span> <span class="nx">path</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">re</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">})();</span>
  </pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h2>The audiojs interface</h2>

<p>This is the global object which provides an interface for creating new <code>audiojs</code> instances.
It also stores all of the construction helper methods and variables.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">container</span><span class="p">[</span><span class="nx">audiojs</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">instanceCount</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">instances</span><span class="o">:</span> <span class="p">{},</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>The markup for the swf. It is injected into the page if there is not support for the <code>&lt;audio&gt;</code> element. The <code>$n</code>s are placeholders. <br />
<code>$1</code> The name of the flash movie <br />
<code>$2</code> The path to the swf <br />
<code>$3</code> Cache invalidation  </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">flashSource</span><span class="o">:</span> <span class="s1">&#39;\</span>
<span class="s1">      &lt;object classid=&quot;clsid:D27CDB6E-AE6D-11cf-96B8-444553540000&quot; id=&quot;$1&quot; width=&quot;1&quot; height=&quot;1&quot; name=&quot;$1&quot; style=&quot;position: absolute; left: -1px;&quot;&gt; \</span>
<span class="s1">        &lt;param name=&quot;movie&quot; value=&quot;$2?playerInstance=&#39;</span><span class="o">+</span><span class="nx">audiojs</span><span class="o">+</span><span class="s1">&#39;.instances[\&#39;$1\&#39;]&amp;datetime=$3&quot;&gt; \</span>
<span class="s1">        &lt;param name=&quot;allowscriptaccess&quot; value=&quot;always&quot;&gt; \</span>
<span class="s1">        &lt;embed name=&quot;$1&quot; src=&quot;$2?playerInstance=&#39;</span><span class="o">+</span><span class="nx">audiojs</span><span class="o">+</span><span class="s1">&#39;.instances[\&#39;$1\&#39;]&amp;datetime=$3&quot; width=&quot;1&quot; height=&quot;1&quot; allowscriptaccess=&quot;always&quot;&gt; \</span>
<span class="s1">      &lt;/object&gt;&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h3>The main settings object</h3>

<p>Where all the default settings are stored. Each of these variables and methods can be overwritten by the user-provided <code>options</code> object.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">settings</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">autoplay</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">loop</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">preload</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="nx">imageLocation</span><span class="o">:</span> <span class="nx">path</span> <span class="o">+</span> <span class="s1">&#39;player-graphics.gif&#39;</span><span class="p">,</span>
      <span class="nx">swfLocation</span><span class="o">:</span> <span class="nx">path</span> <span class="o">+</span> <span class="s1">&#39;audiojs.swf&#39;</span><span class="p">,</span>
      <span class="nx">useFlash</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;audio&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">canPlayType</span> <span class="o">&amp;&amp;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">canPlayType</span><span class="p">(</span><span class="s1">&#39;audio/mpeg;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/no/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">));</span>
      <span class="p">})(),</span>
      <span class="nx">hasFlash</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">plugins</span> <span class="o">&amp;&amp;</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">plugins</span><span class="p">[</span><span class="s1">&#39;Shockwave Flash&#39;</span><span class="p">])</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">mimeTypes</span> <span class="o">&amp;&amp;</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">mimeTypes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">mimeType</span> <span class="o">=</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">mimeTypes</span><span class="p">[</span><span class="s1">&#39;application/x-shockwave-flash&#39;</span><span class="p">];</span>
          <span class="k">return</span> <span class="nx">mimeType</span> <span class="o">&amp;&amp;</span> <span class="nx">mimeType</span><span class="p">.</span><span class="nx">enabledPlugin</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">try</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">ax</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ActiveXObject</span><span class="p">(</span><span class="s1">&#39;ShockwaveFlash.ShockwaveFlash&#39;</span><span class="p">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">})(),</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>The default markup and classes for creating the player:</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">createPlayer</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">markup</span><span class="o">:</span> <span class="s1">&#39;\</span>
<span class="s1">          &lt;div class=&quot;play-pause&quot;&gt; \</span>
<span class="s1">            &lt;p class=&quot;play&quot;&gt;&lt;/p&gt; \</span>
<span class="s1">            &lt;p class=&quot;pause&quot;&gt;&lt;/p&gt; \</span>
<span class="s1">            &lt;p class=&quot;loading&quot;&gt;&lt;/p&gt; \</span>
<span class="s1">            &lt;p class=&quot;error&quot;&gt;&lt;/p&gt; \</span>
<span class="s1">          &lt;/div&gt; \</span>
<span class="s1">          &lt;div class=&quot;scrubber&quot;&gt; \</span>
<span class="s1">            &lt;div class=&quot;progress&quot;&gt;&lt;/div&gt; \</span>
<span class="s1">            &lt;div class=&quot;loaded&quot;&gt;&lt;/div&gt; \</span>
<span class="s1">          &lt;/div&gt; \</span>
<span class="s1">          &lt;div class=&quot;time&quot;&gt; \</span>
<span class="s1">            &lt;em class=&quot;played&quot;&gt;00:00&lt;/em&gt;/&lt;strong class=&quot;duration&quot;&gt;00:00&lt;/strong&gt; \</span>
<span class="s1">          &lt;/div&gt; \</span>
<span class="s1">          &lt;div class=&quot;error-message&quot;&gt;&lt;/div&gt;&#39;</span><span class="p">,</span>
        <span class="nx">playPauseClass</span><span class="o">:</span> <span class="s1">&#39;play-pause&#39;</span><span class="p">,</span>
        <span class="nx">scrubberClass</span><span class="o">:</span> <span class="s1">&#39;scrubber&#39;</span><span class="p">,</span>
        <span class="nx">progressClass</span><span class="o">:</span> <span class="s1">&#39;progress&#39;</span><span class="p">,</span>
        <span class="nx">loaderClass</span><span class="o">:</span> <span class="s1">&#39;loaded&#39;</span><span class="p">,</span>
        <span class="nx">timeClass</span><span class="o">:</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span>
        <span class="nx">durationClass</span><span class="o">:</span> <span class="s1">&#39;duration&#39;</span><span class="p">,</span>
        <span class="nx">playedClass</span><span class="o">:</span> <span class="s1">&#39;played&#39;</span><span class="p">,</span>
        <span class="nx">errorMessageClass</span><span class="o">:</span> <span class="s1">&#39;error-message&#39;</span><span class="p">,</span>
        <span class="nx">playingClass</span><span class="o">:</span> <span class="s1">&#39;playing&#39;</span><span class="p">,</span>
        <span class="nx">loadingClass</span><span class="o">:</span> <span class="s1">&#39;loading&#39;</span><span class="p">,</span>
        <span class="nx">errorClass</span><span class="o">:</span> <span class="s1">&#39;error&#39;</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>The css used by the default player. This is is dynamically injected into a <code>&lt;style&gt;</code> tag in the top of the head.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">css</span><span class="o">:</span> <span class="s1">&#39;\</span>
<span class="s1">        .audiojs audio { position: absolute; left: -1px; } \</span>
<span class="s1">        .audiojs { width: 460px; height: 36px; background: #404040; overflow: hidden; font-family: monospace; font-size: 12px; \</span>
<span class="s1">          background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #444), color-stop(0.5, #555), color-stop(0.51, #444), color-stop(1, #444)); \</span>
<span class="s1">          background-image: -moz-linear-gradient(center top, #444 0%, #555 50%, #444 51%, #444 100%); \</span>
<span class="s1">          -webkit-box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.3); -moz-box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.3); \</span>
<span class="s1">          -o-box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.3); box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.3); } \</span>
<span class="s1">        .audiojs .play-pause { width: 25px; height: 40px; padding: 4px 6px; margin: 0px; float: left; overflow: hidden; border-right: 1px solid #000; } \</span>
<span class="s1">        .audiojs p { display: none; width: 25px; height: 40px; margin: 0px; cursor: pointer; } \</span>
<span class="s1">        .audiojs .play { display: block; } \</span>
<span class="s1">        .audiojs .scrubber { position: relative; float: left; width: 280px; background: #5a5a5a; height: 14px; margin: 10px; border-top: 1px solid #3f3f3f; border-left: 0px; border-bottom: 0px; overflow: hidden; } \</span>
<span class="s1">        .audiojs .progress { position: absolute; top: 0px; left: 0px; height: 14px; width: 0px; background: #ccc; z-index: 1; \</span>
<span class="s1">          background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #ccc), color-stop(0.5, #ddd), color-stop(0.51, #ccc), color-stop(1, #ccc)); \</span>
<span class="s1">          background-image: -moz-linear-gradient(center top, #ccc 0%, #ddd 50%, #ccc 51%, #ccc 100%); } \</span>
<span class="s1">        .audiojs .loaded { position: absolute; top: 0px; left: 0px; height: 14px; width: 0px; background: #000; \</span>
<span class="s1">          background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #222), color-stop(0.5, #333), color-stop(0.51, #222), color-stop(1, #222)); \</span>
<span class="s1">          background-image: -moz-linear-gradient(center top, #222 0%, #333 50%, #222 51%, #222 100%); } \</span>
<span class="s1">        .audiojs .time { float: left; height: 36px; line-height: 36px; margin: 0px 0px 0px 6px; padding: 0px 6px 0px 12px; border-left: 1px solid #000; color: #ddd; text-shadow: 1px 1px 0px rgba(0, 0, 0, 0.5); } \</span>
<span class="s1">        .audiojs .time em { padding: 0px 2px 0px 0px; color: #f9f9f9; font-style: normal; } \</span>
<span class="s1">        .audiojs .time strong { padding: 0px 0px 0px 2px; font-weight: normal; } \</span>
<span class="s1">        .audiojs .error-message { float: left; display: none; margin: 0px 10px; height: 36px; width: 400px; overflow: hidden; line-height: 36px; white-space: nowrap; color: #fff; \</span>
<span class="s1">          text-overflow: ellipsis; -o-text-overflow: ellipsis; -icab-text-overflow: ellipsis; -khtml-text-overflow: ellipsis; -moz-text-overflow: ellipsis; -webkit-text-overflow: ellipsis; } \</span>
<span class="s1">        .audiojs .error-message a { color: #eee; text-decoration: none; padding-bottom: 1px; border-bottom: 1px solid #999; white-space: wrap; } \</span>
<span class="s1">        \</span>
<span class="s1">        .audiojs .play { background: url(&quot;$1&quot;) -2px -1px no-repeat; } \</span>
<span class="s1">        .audiojs .loading { background: url(&quot;$1&quot;) -2px -31px no-repeat; } \</span>
<span class="s1">        .audiojs .error { background: url(&quot;$1&quot;) -2px -61px no-repeat; } \</span>
<span class="s1">        .audiojs .pause { background: url(&quot;$1&quot;) -2px -91px no-repeat; } \</span>
<span class="s1">        \</span>
<span class="s1">        .playing .play, .playing .loading, .playing .error { display: none; } \</span>
<span class="s1">        .playing .pause { display: block; } \</span>
<span class="s1">        \</span>
<span class="s1">        .loading .play, .loading .pause, .loading .error { display: none; } \</span>
<span class="s1">        .loading .loading { display: block; } \</span>
<span class="s1">        \</span>
<span class="s1">        .error .time, .error .play, .error .pause, .error .scrubber, .error .loading { display: none; } \</span>
<span class="s1">        .error .error { display: block; } \</span>
<span class="s1">        .error .play-pause p { cursor: auto; } \</span>
<span class="s1">        .error .error-message { display: block; }&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>The default event callbacks:</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">trackEnded</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{},</span>
      <span class="nx">flashError</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">createPlayer</span><span class="p">,</span>
            <span class="nx">errorMessage</span> <span class="o">=</span> <span class="nx">getByClass</span><span class="p">(</span><span class="nx">player</span><span class="p">.</span><span class="nx">errorMessageClass</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">),</span>
            <span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;Missing &lt;a href=&quot;http://get.adobe.com/flashplayer/&quot;&gt;flash player&lt;/a&gt; plugin.&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">mp3</span><span class="p">)</span> <span class="nx">html</span> <span class="o">+=</span> <span class="s1">&#39; &lt;a href=&quot;&#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">mp3</span><span class="o">+</span><span class="s1">&#39;&quot;&gt;Download audio file&lt;/a&gt;.&#39;</span><span class="p">;</span>
        <span class="nx">container</span><span class="p">[</span><span class="nx">audiojs</span><span class="p">].</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">,</span> <span class="nx">player</span><span class="p">.</span><span class="nx">loadingClass</span><span class="p">);</span>
        <span class="nx">container</span><span class="p">[</span><span class="nx">audiojs</span><span class="p">].</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">,</span> <span class="nx">player</span><span class="p">.</span><span class="nx">errorClass</span><span class="p">);</span>
        <span class="nx">errorMessage</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">html</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">loadError</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">createPlayer</span><span class="p">,</span>
            <span class="nx">errorMessage</span> <span class="o">=</span> <span class="nx">getByClass</span><span class="p">(</span><span class="nx">player</span><span class="p">.</span><span class="nx">errorMessageClass</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">);</span>
        <span class="nx">container</span><span class="p">[</span><span class="nx">audiojs</span><span class="p">].</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">,</span> <span class="nx">player</span><span class="p">.</span><span class="nx">loadingClass</span><span class="p">);</span>
        <span class="nx">container</span><span class="p">[</span><span class="nx">audiojs</span><span class="p">].</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">,</span> <span class="nx">player</span><span class="p">.</span><span class="nx">errorClass</span><span class="p">);</span>
        <span class="nx">errorMessage</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;Error loading: &quot;&#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">mp3</span><span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">createPlayer</span><span class="p">;</span>
        <span class="nx">container</span><span class="p">[</span><span class="nx">audiojs</span><span class="p">].</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">,</span> <span class="nx">player</span><span class="p">.</span><span class="nx">loadingClass</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">loadStarted</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">createPlayer</span><span class="p">,</span>
            <span class="nx">duration</span> <span class="o">=</span> <span class="nx">getByClass</span><span class="p">(</span><span class="nx">player</span><span class="p">.</span><span class="nx">durationClass</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">),</span>
            <span class="nx">m</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">duration</span> <span class="o">/</span> <span class="mi">60</span><span class="p">),</span>
            <span class="nx">s</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">duration</span> <span class="o">%</span> <span class="mi">60</span><span class="p">);</span>
        <span class="nx">container</span><span class="p">[</span><span class="nx">audiojs</span><span class="p">].</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">,</span> <span class="nx">player</span><span class="p">.</span><span class="nx">loadingClass</span><span class="p">);</span>
        <span class="nx">duration</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="p">((</span><span class="nx">m</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">?</span><span class="s1">&#39;0&#39;</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="nx">m</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="p">(</span><span class="nx">s</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">?</span><span class="s1">&#39;0&#39;</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="nx">s</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">loadProgress</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">percent</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">createPlayer</span><span class="p">,</span>
            <span class="nx">scrubber</span> <span class="o">=</span> <span class="nx">getByClass</span><span class="p">(</span><span class="nx">player</span><span class="p">.</span><span class="nx">scrubberClass</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">),</span>
            <span class="nx">loaded</span> <span class="o">=</span> <span class="nx">getByClass</span><span class="p">(</span><span class="nx">player</span><span class="p">.</span><span class="nx">loaderClass</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">);</span>
        <span class="nx">loaded</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="p">(</span><span class="nx">scrubber</span><span class="p">.</span><span class="nx">offsetWidth</span> <span class="o">*</span> <span class="nx">percent</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">playPause</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">playing</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
        <span class="k">else</span> <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span>
      <span class="p">},</span>
      <span class="nx">play</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">createPlayer</span><span class="p">;</span>
        <span class="nx">container</span><span class="p">[</span><span class="nx">audiojs</span><span class="p">].</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">,</span> <span class="nx">player</span><span class="p">.</span><span class="nx">playingClass</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">pause</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">createPlayer</span><span class="p">;</span>
        <span class="nx">container</span><span class="p">[</span><span class="nx">audiojs</span><span class="p">].</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">,</span> <span class="nx">player</span><span class="p">.</span><span class="nx">playingClass</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">updatePlayhead</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">percent</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">createPlayer</span><span class="p">,</span>
            <span class="nx">scrubber</span> <span class="o">=</span> <span class="nx">getByClass</span><span class="p">(</span><span class="nx">player</span><span class="p">.</span><span class="nx">scrubberClass</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">),</span>
            <span class="nx">progress</span> <span class="o">=</span> <span class="nx">getByClass</span><span class="p">(</span><span class="nx">player</span><span class="p">.</span><span class="nx">progressClass</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">);</span>
        <span class="nx">progress</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="p">(</span><span class="nx">scrubber</span><span class="p">.</span><span class="nx">offsetWidth</span> <span class="o">*</span> <span class="nx">percent</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">played</span> <span class="o">=</span> <span class="nx">getByClass</span><span class="p">(</span><span class="nx">player</span><span class="p">.</span><span class="nx">playedClass</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">),</span>
            <span class="nx">p</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">duration</span> <span class="o">*</span> <span class="nx">percent</span><span class="p">,</span>
            <span class="nx">m</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">p</span> <span class="o">/</span> <span class="mi">60</span><span class="p">),</span>
            <span class="nx">s</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">p</span> <span class="o">%</span> <span class="mi">60</span><span class="p">);</span>
        <span class="nx">played</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="p">((</span><span class="nx">m</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">?</span><span class="s1">&#39;0&#39;</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="nx">m</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="p">(</span><span class="nx">s</span><span class="o">&lt;</span><span class="mi">10</span><span class="o">?</span><span class="s1">&#39;0&#39;</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="nx">s</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h3>Contructor functions</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p><code>create()</code> <br />
Used to create a single <code>audiojs</code> instance. <br />
If an array is passed then it calls back to <code>createAll()</code>. <br />
Otherwise, it creates a single instance and returns it.  </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">create</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">createAll</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">element</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">newInstance</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p><code>createAll()</code> <br />
Creates multiple <code>audiojs</code> instances. <br />
If <code>elements</code> is <code>null</code>, then automatically find any <code>&lt;audio&gt;</code> tags on the page and create <code>audiojs</code> instances for them.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">createAll</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">elements</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">audioElements</span> <span class="o">=</span> <span class="nx">elements</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;audio&#39;</span><span class="p">),</span>
          <span class="nx">instances</span> <span class="o">=</span> <span class="p">[]</span>
          <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ii</span> <span class="o">=</span> <span class="nx">audioElements</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">instances</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">newInstance</span><span class="p">(</span><span class="nx">audioElements</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">options</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">instances</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h3>Creating and returning a new instance</h3>

<p>This goes through all the steps required to build out a usable <code>audiojs</code> instance.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">newInstance</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">element</span><span class="p">,</span>
          <span class="nx">s</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">),</span>
          <span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;audiojs&#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">instanceCount</span><span class="p">,</span>
          <span class="nx">wrapperId</span> <span class="o">=</span> <span class="s1">&#39;audiojs_wrapper&#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">instanceCount</span><span class="p">,</span>
          <span class="nx">instanceCount</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">instanceCount</span><span class="o">++</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Check for <code>autoplay</code>, <code>loop</code> and <code>preload</code> attributes and write them into the settings.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;autoplay&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">s</span><span class="p">.</span><span class="nx">autoplay</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;loop&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">s</span><span class="p">.</span><span class="nx">loop</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;preload&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="nx">s</span><span class="p">.</span><span class="nx">preload</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Merge the default settings with the user-defined <code>options</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Inject the player html if required.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">createPlayer</span><span class="p">.</span><span class="nx">markup</span><span class="p">)</span> <span class="nx">element</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createPlayer</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">s</span><span class="p">.</span><span class="nx">createPlayer</span><span class="p">,</span> <span class="nx">wrapperId</span><span class="p">);</span>
      <span class="k">else</span> <span class="nx">element</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">wrapperId</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Return a new <code>audiojs</code> instance.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">audio</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">container</span><span class="p">[</span><span class="nx">audiojsInstance</span><span class="p">](</span><span class="nx">element</span><span class="p">,</span> <span class="nx">s</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>If css has been passed in, dynamically inject it into the <code>&lt;head&gt;</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">css</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">injectCss</span><span class="p">(</span><span class="nx">audio</span><span class="p">,</span> <span class="nx">s</span><span class="p">.</span><span class="nx">css</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>If <code>&lt;audio&gt;</code> or mp3 playback isn't supported, insert the swf &amp; attach the required events for it.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">useFlash</span> <span class="o">&amp;&amp;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">hasFlash</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">injectFlash</span><span class="p">(</span><span class="nx">audio</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">attachFlashEvents</span><span class="p">(</span><span class="nx">audio</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">,</span> <span class="nx">audio</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">useFlash</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">s</span><span class="p">.</span><span class="nx">hasFlash</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">flashError</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">audio</span><span class="p">);</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Attach event callbacks to the new audiojs instance.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">s</span><span class="p">.</span><span class="nx">useFlash</span> <span class="o">||</span> <span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">useFlash</span> <span class="o">&amp;&amp;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">hasFlash</span><span class="p">))</span> <span class="k">this</span><span class="p">.</span><span class="nx">attachEvents</span><span class="p">(</span><span class="nx">audio</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">,</span> <span class="nx">audio</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Store the newly-created <code>audiojs</code> instance.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">instances</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">audio</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">audio</span><span class="p">;</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <h3>Helper methods for constructing a working player</h3>

<p>Inject a wrapping div and the markup for the html player.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">createPlayer</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">player</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">wrapper</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">),</span>
          <span class="nx">newElement</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
      <span class="nx">wrapper</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;audiojs&#39;</span><span class="p">);</span>
      <span class="nx">wrapper</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;className&#39;</span><span class="p">,</span> <span class="s1">&#39;audiojs&#39;</span><span class="p">);</span>
      <span class="nx">wrapper</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Fix IE's broken implementation of <code>innerHTML</code> &amp; <code>cloneNode</code> for HTML5 elements.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">newElement</span><span class="p">.</span><span class="nx">outerHTML</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;audio&#39;</span><span class="p">).</span><span class="nx">canPlayType</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">newElement</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">cloneHtml5Node</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">player</span><span class="p">.</span><span class="nx">markup</span><span class="p">;</span>
        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">newElement</span><span class="p">);</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">outerHTML</span> <span class="o">=</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">outerHTML</span><span class="p">;</span>
        <span class="nx">wrapper</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">newElement</span><span class="p">);</span>
        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+</span> <span class="nx">player</span><span class="p">.</span><span class="nx">markup</span><span class="p">;</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">replaceChild</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">,</span> <span class="nx">element</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;audio&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Attaches useful event callbacks to an <code>audiojs</code> instance.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">attachEvents</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">wrapper</span><span class="p">,</span> <span class="nx">audio</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">audio</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">createPlayer</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="nx">audio</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">createPlayer</span><span class="p">,</span>
          <span class="nx">playPause</span> <span class="o">=</span> <span class="nx">getByClass</span><span class="p">(</span><span class="nx">player</span><span class="p">.</span><span class="nx">playPauseClass</span><span class="p">,</span> <span class="nx">wrapper</span><span class="p">),</span>
          <span class="nx">scrubber</span> <span class="o">=</span> <span class="nx">getByClass</span><span class="p">(</span><span class="nx">player</span><span class="p">.</span><span class="nx">scrubberClass</span><span class="p">,</span> <span class="nx">wrapper</span><span class="p">),</span>
          <span class="nx">leftPos</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">curleft</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">offsetParent</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">do</span> <span class="p">{</span> <span class="nx">curleft</span> <span class="o">+=</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">offsetLeft</span><span class="p">;</span> <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nx">elem</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">offsetParent</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">curleft</span><span class="p">;</span>
          <span class="p">};</span>

      <span class="nx">container</span><span class="p">[</span><span class="nx">audiojs</span><span class="p">].</span><span class="nx">events</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">playPause</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">audio</span><span class="p">.</span><span class="nx">playPause</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">audio</span><span class="p">);</span>
      <span class="p">});</span>

      <span class="nx">container</span><span class="p">[</span><span class="nx">audiojs</span><span class="p">].</span><span class="nx">events</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">scrubber</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">relativeLeft</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">-</span> <span class="nx">leftPos</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="nx">audio</span><span class="p">.</span><span class="nx">skipTo</span><span class="p">(</span><span class="nx">relativeLeft</span> <span class="o">/</span> <span class="nx">scrubber</span><span class="p">.</span><span class="nx">offsetWidth</span><span class="p">);</span>
      <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p><em>If flash is being used, then the following handlers don't need to be registered.</em></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">audio</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">useFlash</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Start tracking the load progress of the track.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">container</span><span class="p">[</span><span class="nx">audiojs</span><span class="p">].</span><span class="nx">events</span><span class="p">.</span><span class="nx">trackLoadProgress</span><span class="p">(</span><span class="nx">audio</span><span class="p">);</span>

      <span class="nx">container</span><span class="p">[</span><span class="nx">audiojs</span><span class="p">].</span><span class="nx">events</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">audio</span><span class="p">.</span><span class="nx">element</span><span class="p">,</span> <span class="s1">&#39;timeupdate&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">audio</span><span class="p">.</span><span class="nx">updatePlayhead</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">audio</span><span class="p">);</span>
      <span class="p">});</span>

      <span class="nx">container</span><span class="p">[</span><span class="nx">audiojs</span><span class="p">].</span><span class="nx">events</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">audio</span><span class="p">.</span><span class="nx">element</span><span class="p">,</span> <span class="s1">&#39;ended&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">audio</span><span class="p">.</span><span class="nx">trackEnded</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">audio</span><span class="p">);</span>
      <span class="p">});</span>

      <span class="nx">container</span><span class="p">[</span><span class="nx">audiojs</span><span class="p">].</span><span class="nx">events</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">audio</span><span class="p">.</span><span class="nx">source</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>on error, cancel any load timers that are running.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">audio</span><span class="p">.</span><span class="nx">readyTimer</span><span class="p">);</span>
        <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">audio</span><span class="p">.</span><span class="nx">loadTimer</span><span class="p">);</span>
        <span class="nx">audio</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">loadError</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">audio</span><span class="p">);</span>
      <span class="p">});</span>

    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Flash requires a slightly different API to the <code>&lt;audio&gt;</code> element, so this method is used to overwrite the standard event handlers.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">attachFlashEvents</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">audio</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">audio</span><span class="p">[</span><span class="s1">&#39;swfReady&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="nx">audio</span><span class="p">[</span><span class="s1">&#39;load&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">mp3</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>If the swf isn't ready yet then just set <code>audio.mp3</code>. <code>init()</code> will load it in once the swf is ready.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">audio</span><span class="p">.</span><span class="nx">mp3</span> <span class="o">=</span> <span class="nx">mp3</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">audio</span><span class="p">.</span><span class="nx">swfReady</span><span class="p">)</span> <span class="nx">audio</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">mp3</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">audio</span><span class="p">[</span><span class="s1">&#39;loadProgress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">percent</span><span class="p">,</span> <span class="nx">duration</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">audio</span><span class="p">.</span><span class="nx">loadedPercent</span> <span class="o">=</span> <span class="nx">percent</span><span class="p">;</span>
        <span class="nx">audio</span><span class="p">.</span><span class="nx">duration</span> <span class="o">=</span> <span class="nx">duration</span><span class="p">;</span>
        <span class="nx">audio</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">loadStarted</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">audio</span><span class="p">);</span>
        <span class="nx">audio</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">loadProgress</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">audio</span><span class="p">,</span> <span class="p">[</span><span class="nx">percent</span><span class="p">]);</span>
      <span class="p">}</span>
      <span class="nx">audio</span><span class="p">[</span><span class="s1">&#39;skipTo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">percent</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">percent</span> <span class="o">&gt;</span> <span class="nx">audio</span><span class="p">.</span><span class="nx">loadedPercent</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="nx">audio</span><span class="p">.</span><span class="nx">updatePlayhead</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">audio</span><span class="p">,</span> <span class="p">[</span><span class="nx">percent</span><span class="p">])</span>
        <span class="nx">audio</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">skipTo</span><span class="p">(</span><span class="nx">percent</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">audio</span><span class="p">[</span><span class="s1">&#39;updatePlayhead&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">percent</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">audio</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">updatePlayhead</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">audio</span><span class="p">,</span> <span class="p">[</span><span class="nx">percent</span><span class="p">]);</span>
      <span class="p">}</span>
      <span class="nx">audio</span><span class="p">[</span><span class="s1">&#39;play&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>If the audio hasn't started preloading, then start it now. <br />
Then set <code>preload</code> to <code>true</code>, so that any tracks loaded in subsequently are loaded straight away.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">audio</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">preload</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">audio</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">preload</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="nx">audio</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">audio</span><span class="p">.</span><span class="nx">mp3</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">audio</span><span class="p">.</span><span class="nx">playing</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>IE doesn't allow a method named <code>play()</code> to be exposed through <code>ExternalInterface</code>, so lets go with <code>pplay()</code>. <br />
<a href="http://dev.nuclearrooster.com/2008/07/27/externalinterfaceaddcallback-can-cause-ie-js-errors-with-certain-keyworkds/">http://dev.nuclearrooster.com/2008/07/27/externalinterfaceaddcallback-can-cause-ie-js-errors-with-certain-keyworkds/</a></p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">audio</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">pplay</span><span class="p">();</span>
        <span class="nx">audio</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">play</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">audio</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">audio</span><span class="p">[</span><span class="s1">&#39;pause&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">audio</span><span class="p">.</span><span class="nx">playing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Use <code>ppause()</code> for consistency with <code>pplay()</code>, even though it isn't really required.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">audio</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">ppause</span><span class="p">();</span>
        <span class="nx">audio</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">pause</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">audio</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">audio</span><span class="p">[</span><span class="s1">&#39;setVolume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">audio</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">setVolume</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">audio</span><span class="p">[</span><span class="s1">&#39;loadStarted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Load the mp3 specified by the audio element into the swf.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">audio</span><span class="p">.</span><span class="nx">swfReady</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">audio</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">preload</span><span class="p">)</span> <span class="nx">audio</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">audio</span><span class="p">.</span><span class="nx">mp3</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">audio</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">autoplay</span><span class="p">)</span> <span class="nx">audio</span><span class="p">.</span><span class="nx">play</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">audio</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <h3>Injecting an swf from a string</h3>

<p>Build up the swf source by replacing the <code>$keys</code> and then inject the markup into the page.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">injectFlash</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">audio</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">flashSource</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">flashSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\$1/g</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span>
      <span class="nx">flashSource</span> <span class="o">=</span> <span class="nx">flashSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\$2/g</span><span class="p">,</span> <span class="nx">audio</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">swfLocation</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p><code>(+new Date)</code> ensures the swf is not pulled out of cache. The fixes an issue with Firefox running multiple players on the same page.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">flashSource</span> <span class="o">=</span> <span class="nx">flashSource</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\$3/g</span><span class="p">,</span> <span class="p">(</span><span class="o">+</span><span class="k">new</span> <span class="nb">Date</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()));</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Inject the player markup using a more verbose <code>innerHTML</code> insertion technique that works with IE.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">audio</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">,</span>
          <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
      <span class="nx">div</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">flashSource</span> <span class="o">+</span> <span class="nx">html</span><span class="p">;</span>
      <span class="nx">audio</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">div</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
      <span class="nx">audio</span><span class="p">.</span><span class="nx">element</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">getSwf</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <h2>Helper functions</h2>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">helpers</span><span class="o">:</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p><strong>Merge two objects, with <code>obj2</code> overwriting <code>obj1</code></strong> <br />
The merge is shallow, but that's all that is required for our purposes.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">merge</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj1</span><span class="p">,</span> <span class="nx">obj2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">attr</span> <span class="k">in</span> <span class="nx">obj2</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">obj1</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">attr</span><span class="p">)</span> <span class="o">||</span> <span class="nx">obj2</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">attr</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">obj1</span><span class="p">[</span><span class="nx">attr</span><span class="p">]</span> <span class="o">=</span> <span class="nx">obj2</span><span class="p">[</span><span class="nx">attr</span><span class="p">];</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p><strong>Clone a javascript object (recursively)</strong></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">clone</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="k">typeof</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">temp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">constructor</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span> <span class="nx">temp</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">]);</span>
        <span class="k">return</span> <span class="nx">temp</span><span class="p">;</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p><strong>Adding/removing classnames from elements</strong></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">addClass</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">className</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">re</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;(\\s|^)&#39;</span><span class="o">+</span><span class="nx">className</span><span class="o">+</span><span class="s1">&#39;(\\s|$)&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">re</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">className</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">className</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">className</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="nx">removeClass</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">className</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">re</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;(\\s|^)&#39;</span><span class="o">+</span><span class="nx">className</span><span class="o">+</span><span class="s1">&#39;(\\s|$)&#39;</span><span class="p">);</span>
        <span class="nx">element</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">className</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">re</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">);</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p><strong>Dynamic CSS injection</strong> <br />
Takes a string of css, inserts it into a <code>&lt;style&gt;</code>, then injects it in at the very top of the <code>&lt;head&gt;</code>. This ensures any user-defined styles will take precedence.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">injectCss</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">audio</span><span class="p">,</span> <span class="nx">string</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>If an <code>audiojs</code> <code>&lt;style&gt;</code> tag already exists, then append to it rather than creating a whole new <code>&lt;style&gt;</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">prepend</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="nx">styles</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">),</span>
            <span class="nx">css</span> <span class="o">=</span> <span class="nx">string</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\$1/g</span><span class="p">,</span> <span class="nx">audio</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">imageLocation</span><span class="p">);</span>

        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ii</span> <span class="o">=</span> <span class="nx">styles</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">styles</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">title</span> <span class="o">&amp;&amp;</span> <span class="o">~</span><span class="nx">title</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;audiojs&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">style</span> <span class="o">=</span> <span class="nx">styles</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">===</span> <span class="nx">css</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
            <span class="nx">prepend</span> <span class="o">=</span> <span class="nx">style</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">};</span>

        <span class="kd">var</span> <span class="nx">head</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nx">firstchild</span> <span class="o">=</span> <span class="nx">head</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">,</span>
            <span class="nx">style</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;style&#39;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">head</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

        <span class="nx">style</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/css&#39;</span><span class="p">);</span>
        <span class="nx">style</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;audiojs&#39;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">style</span><span class="p">.</span><span class="nx">styleSheet</span><span class="p">)</span> <span class="nx">style</span><span class="p">.</span><span class="nx">styleSheet</span><span class="p">.</span><span class="nx">cssText</span> <span class="o">=</span> <span class="nx">prepend</span> <span class="o">+</span> <span class="nx">css</span><span class="p">;</span>
        <span class="k">else</span> <span class="nx">style</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="nx">prepend</span> <span class="o">+</span> <span class="nx">css</span><span class="p">));</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">firstchild</span><span class="p">)</span> <span class="nx">head</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">style</span><span class="p">,</span> <span class="nx">firstchild</span><span class="p">);</span>
        <span class="k">else</span> <span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">styleElement</span><span class="p">);</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p><strong>Handle all the IE6+7 requirements for cloning <code>&lt;audio&gt;</code> nodes</strong> <br />
Create a html5-safe document fragment by injecting an <code>&lt;audio&gt;</code> element into the document fragment.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">cloneHtml5Node</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">audioTag</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">fragment</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createDocumentFragment</span><span class="p">();</span>
        <span class="nx">fragment</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;audio&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nx">fragment</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>
        <span class="nx">fragment</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">div</span><span class="p">);</span>
        <span class="nx">div</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">audioTag</span><span class="p">.</span><span class="nx">outerHTML</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">div</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">;</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p><strong>Cross-browser <code>&lt;object&gt;</code> / <code>&lt;embed&gt;</code> element selection</strong></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">getSwf</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">swf</span> <span class="o">=</span> <span class="nb">document</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">||</span> <span class="nb">window</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
        <span class="k">return</span> <span class="nx">swf</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">?</span> <span class="nx">swf</span><span class="p">[</span><span class="nx">swf</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">:</span> <span class="nx">swf</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <h2>Event-handling</h2>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">memoryLeaking</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">listeners</span><span class="o">:</span> <span class="p">[],</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p><strong>A simple cross-browser event handler abstraction</strong></p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">addListener</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">eventName</span><span class="p">,</span> <span class="nx">func</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>For modern browsers use the standard DOM-compliant <code>addEventListener</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">element</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">func</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>For older versions of Internet Explorer, use <code>attachEvent</code>. <br />
Also provide a fix for scoping <code>this</code> to the calling element and register each listener so the containing elements can be purged on page unload.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">memoryLeaking</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">window</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="s1">&#39;onunload&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
              <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ii</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ii</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nx">container</span><span class="p">[</span><span class="nx">audiojs</span><span class="p">].</span><span class="nx">events</span><span class="p">.</span><span class="nx">purge</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">});</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">memoryLeaking</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="nx">element</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="s1">&#39;on&#39;</span> <span class="o">+</span> <span class="nx">eventName</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">func</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">event</span><span class="p">);</span>
          <span class="p">});</span>
        <span class="p">}</span>
      <span class="p">},</span>

      <span class="nx">trackLoadProgress</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">audio</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>If <code>preload</code> has been set to <code>none</code>, then we don't want to start loading the track yet.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">audio</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">preload</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">readyTimer</span><span class="p">,</span>
            <span class="nx">loadTimer</span><span class="p">,</span>
            <span class="nx">audio</span> <span class="o">=</span> <span class="nx">audio</span><span class="p">,</span>
            <span class="nx">ios</span> <span class="o">=</span> <span class="p">(</span><span class="sr">/(ipod|iphone|ipad)/i</span><span class="p">).</span><span class="nx">test</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Use timers here rather than the official <code>progress</code> event, as Chrome has issues calling <code>progress</code> when loading mp3 files from cache.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">readyTimer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">audio</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>iOS doesn't start preloading the mp3 until the user interacts manually, so this stops the loader being displayed prematurely.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">ios</span><span class="p">)</span> <span class="nx">audio</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">audio</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">audio</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">audio</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">autoplay</span><span class="p">)</span> <span class="nx">audio</span><span class="p">.</span><span class="nx">play</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">audio</span><span class="p">);</span>
            <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">readyTimer</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Once we have data, start tracking the load progress.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">loadTimer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
              <span class="nx">audio</span><span class="p">.</span><span class="nx">loadProgress</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">audio</span><span class="p">);</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">audio</span><span class="p">.</span><span class="nx">loadedPercent</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">loadTimer</span><span class="p">);</span>
            <span class="p">});</span>
          <span class="p">}</span>
        <span class="p">},</span> <span class="mi">10</span><span class="p">);</span>
        <span class="nx">audio</span><span class="p">.</span><span class="nx">readyTimer</span> <span class="o">=</span> <span class="nx">readyTimer</span><span class="p">;</span>
        <span class="nx">audio</span><span class="p">.</span><span class="nx">loadTimer</span> <span class="o">=</span> <span class="nx">loadTimer</span><span class="p">;</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p><strong>Douglas Crockford's IE6 memory leak fix</strong> <br />
<a href="http://javascript.crockford.com/memory/leak.html">http://javascript.crockford.com/memory/leak.html</a> <br />
This is used to release the memory leak created by the circular references created when fixing <code>this</code> scoping for IE. It is called on page unload.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">purge</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">attributes</span><span class="p">,</span> <span class="nx">i</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">d</span><span class="p">[</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="nx">d</span><span class="p">[</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="nx">a</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">)</span> <span class="nx">purge</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
        <span class="p">}</span>
      <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p><strong>DOMready function</strong> <br />
As seen here: <a href="https://github.com/dperini/ContentLoaded/">https://github.com/dperini/ContentLoaded/</a>.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">ready</span><span class="o">:</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">win</span> <span class="o">=</span> <span class="nb">window</span><span class="p">,</span> <span class="nx">done</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">top</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">doc</span> <span class="o">=</span> <span class="nx">win</span><span class="p">.</span><span class="nb">document</span><span class="p">,</span> <span class="nx">root</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">,</span>
        <span class="nx">add</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="o">?</span> <span class="s1">&#39;addEventListener&#39;</span> <span class="o">:</span> <span class="s1">&#39;attachEvent&#39;</span><span class="p">,</span>
        <span class="nx">rem</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="o">?</span> <span class="s1">&#39;removeEventListener&#39;</span> <span class="o">:</span> <span class="s1">&#39;detachEvent&#39;</span><span class="p">,</span>
        <span class="nx">pre</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="s1">&#39;on&#39;</span><span class="p">,</span>
        <span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">&#39;readystatechange&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">!=</span> <span class="s1">&#39;complete&#39;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
          <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">&#39;load&#39;</span> <span class="o">?</span> <span class="nx">win</span> <span class="o">:</span> <span class="nx">doc</span><span class="p">)[</span><span class="nx">rem</span><span class="p">](</span><span class="nx">pre</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span> <span class="nx">init</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">done</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">done</span> <span class="o">=</span> <span class="kc">true</span><span class="p">))</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">win</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">||</span> <span class="nx">e</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">poll</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">try</span> <span class="p">{</span> <span class="nx">root</span><span class="p">.</span><span class="nx">doScroll</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">);</span> <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">poll</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
          <span class="nx">init</span><span class="p">(</span><span class="s1">&#39;poll&#39;</span><span class="p">);</span>
        <span class="p">};</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="s1">&#39;complete&#39;</span><span class="p">)</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">win</span><span class="p">,</span> <span class="s1">&#39;lazy&#39;</span><span class="p">);</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">createEventObject</span> <span class="o">&amp;&amp;</span> <span class="nx">root</span><span class="p">.</span><span class="nx">doScroll</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span> <span class="nx">top</span> <span class="o">=</span> <span class="o">!</span><span class="nx">win</span><span class="p">.</span><span class="nx">frameElement</span><span class="p">;</span> <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">top</span><span class="p">)</span> <span class="nx">poll</span><span class="p">();</span>
          <span class="p">}</span>
          <span class="nx">doc</span><span class="p">[</span><span class="nx">add</span><span class="p">](</span><span class="nx">pre</span> <span class="o">+</span> <span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span> <span class="nx">init</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
          <span class="nx">doc</span><span class="p">[</span><span class="nx">add</span><span class="p">](</span><span class="nx">pre</span> <span class="o">+</span> <span class="s1">&#39;readystatechange&#39;</span><span class="p">,</span> <span class="nx">init</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
          <span class="nx">win</span><span class="p">[</span><span class="nx">add</span><span class="p">](</span><span class="nx">pre</span> <span class="o">+</span> <span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="nx">init</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="p">})()</span>

    <span class="p">}</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <h2>The audiojs class</h2>

<p>We create one of these per <code>&lt;audio&gt;</code> and then push them into <code>audiojs['instances']</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">container</span><span class="p">[</span><span class="nx">audiojsInstance</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">settings</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Each audio instance returns an object which contains an API back into the <code>&lt;audio&gt;</code> element.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">element</span> <span class="o">=</span> <span class="nx">element</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">source</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="nx">element</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>First check the <code>&lt;audio&gt;</code> element directly for a src and if one is not found, look for a <code>&lt;source&gt;</code> element.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">mp3</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
      <span class="k">return</span> <span class="nx">element</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">source</span> <span class="o">?</span> <span class="nx">source</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">);</span>
    <span class="p">})(</span><span class="nx">element</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">settings</span> <span class="o">=</span> <span class="nx">settings</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">loadStartedCalled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">loadedPercent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">duration</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">playing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">container</span><span class="p">[</span><span class="nx">audiojsInstance</span><span class="p">].</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>API access events:
Each of these do what they need do and then call the matching methods defined in the settings object.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">updatePlayhead</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">percent</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">currentTime</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">duration</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">updatePlayhead</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="nx">percent</span><span class="p">]);</span>
    <span class="p">},</span>
    <span class="nx">skipTo</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">percent</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">percent</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">loadedPercent</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">currentTime</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">duration</span> <span class="o">*</span> <span class="nx">percent</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">updatePlayhead</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">load</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">mp3</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">loadStartedCalled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="nx">mp3</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>The now outdated <code>load()</code> method is required for Safari 4</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">load</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">mp3</span> <span class="o">=</span> <span class="nx">mp3</span><span class="p">;</span>
      <span class="nx">container</span><span class="p">[</span><span class="nx">audiojs</span><span class="p">].</span><span class="nx">events</span><span class="p">.</span><span class="nx">trackLoadProgress</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">loadError</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">loadError</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">loadStarted</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>Wait until <code>element.duration</code> exists before setting up the audio player.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">duration</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">duration</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">duration</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">updatePlayhead</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">loadStarted</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">loadProgress</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">buffered</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">buffered</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Ensure <code>loadStarted()</code> is only called once.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">loadStartedCalled</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">loadStartedCalled</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">loadStarted</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">durationLoaded</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">buffered</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">buffered</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">loadedPercent</span> <span class="o">=</span> <span class="nx">durationLoaded</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">duration</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">loadProgress</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">loadedPercent</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">playPause</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">playing</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span>
      <span class="k">else</span> <span class="k">this</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">play</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">ios</span> <span class="o">=</span> <span class="p">(</span><span class="sr">/(ipod|iphone|ipad)/i</span><span class="p">).</span><span class="nx">test</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>On iOS this interaction will trigger loading the mp3, so run <code>init()</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">ios</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>If the audio hasn't started preloading, then start it now. <br />
Then set <code>preload</code> to <code>true</code>, so that any tracks loaded in subsequently are loaded straight away.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">preload</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">preload</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;preload&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">);</span>
        <span class="nx">container</span><span class="p">[</span><span class="nx">audiojs</span><span class="p">].</span><span class="nx">events</span><span class="p">.</span><span class="nx">trackLoadProgress</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">playing</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">play</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">pause</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">playing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">pause</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">setVolume</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">volume</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">trackEnded</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">skipTo</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">loop</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">pause</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">trackEnded</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p><strong>getElementsByClassName</strong> <br />
Having to rely on <code>getElementsByTagName</code> is pretty inflexible internally, so a modified version of Dustin Diaz's <code>getElementsByClassName</code> has been included.
This version cleans things up and prefers the native DOM method if it's available.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">getByClass</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">searchClass</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">tag</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">matches</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">matches</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="nx">searchClass</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">node</span> <span class="o">||</span> <span class="nb">document</span><span class="p">,</span>
          <span class="nx">tag</span> <span class="o">=</span> <span class="nx">tag</span> <span class="o">||</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
          <span class="nx">els</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">tag</span><span class="p">),</span>
          <span class="nx">pattern</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;(^|\\s)&quot;</span><span class="o">+</span><span class="nx">searchClass</span><span class="o">+</span><span class="s2">&quot;(\\s|$)&quot;</span><span class="p">);</span>

      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">els</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">els</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">className</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">matches</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">els</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
          <span class="nx">j</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">matches</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">?</span> <span class="nx">matches</span> <span class="o">:</span> <span class="nx">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>The global variable names are passed in here and can be changed if they conflict with anything else.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">})(</span><span class="s1">&#39;audiojs&#39;</span><span class="p">,</span> <span class="s1">&#39;audiojsInstance&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 